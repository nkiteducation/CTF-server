# CTF Server Microservice для Raspberry Pi

## Описание

Этот микросервис предназначен для администрирования CTF (Capture The Flag) игры на устройстве Raspberry Pi. Он построен на высокопроизводительном фреймворке Robyn, написанном на Rust, что обеспечивает высокую скорость работы и низкое потребление памяти, идеально подходя для ограниченных ресурсов RPi.

Сервис позволяет администратору устанавливать конфигурацию флагов через API и предоставляет различные способы получения флагов участниками игры. Код оптимизирован для работы на Raspberry Pi, с учетом ограничений по памяти и процессору.

## Функциональность

- **Установка конфигурации флагов**: Администратор может отправить POST-запрос на `/set-config` с JSON-конфигурацией флагов для разных каналов (web, curl, zip).
- **Генерация защищенного ZIP-файла**: При установке конфигурации автоматически генерируется ZIP-файл с флагом, защищенный паролем из списка (по умолчанию rockyou.txt).
- **Различные каналы получения флагов**:
  - **Web**: Флаг отображается в HTML-странице (скрыт в теге `<flag>`).
  - **Curl**: Флаг возвращается в plain text при запросе с User-Agent, содержащим "curl".
  - **Zip**: Флаг хранится в зашифрованном ZIP-файле.

## Требования

- Raspberry Pi (любая модель)
- Docker (рекомендуется для изоляции и простоты развертывания)
- Python 3.14+ (для локального запуска без Docker)

## Сборка и запуск

### Сборка Docker-образа

```bash
docker build -t ctf-server .
```

### Запуск контейнера на Raspberry Pi

```bash
docker run -p 8080:8080 -v $(pwd):/secret ctf-server
```

Где:
- `-p 8080:8080`: Проброс порта 8080 на хост (RPi)
- `-v $(pwd):/secret`: Монтирование текущей директории в контейнер для доступа к сгенерированным файлам

После запуска сервис будет доступен по адресу `http://<IP_RPi>:8080`.

## API

### POST /set-config

Устанавливает конфигурацию флагов.

**Тело запроса (JSON):**
```json
{
  "zip": "FLAG{ZIP_FLAG}",
  "web": "FLAG{WEB_FLAG}",
  "curl": "FLAG{CURL_FLAG}"
}
```

**Ответ:**
```json
{
  "zip_password": "пароль_для_zip"
}
```

### GET /

Возвращает HTML-страницу или plain text в зависимости от User-Agent.

## Локальный запуск (без Docker) на Raspberry Pi

1. Установите зависимости (используя uv для быстрой установки):
   ```bash
   pip install uv
   uv pip install -r pyproject.toml
   ```

2. Скачайте rockyou.txt (или создайте файл с паролями):
   ```bash
   curl -L https://github.com/danielmiessler/SecLists/raw/master/Passwords/Leaked-Databases/rockyou.txt.tar.gz -o rockyou.txt.tar.gz
   tar -xzf rockyou.txt.tar.gz
   ```

3. Запустите приложение:
   ```bash
   python app.py
   ```

## Структура проекта

- `app.py`: Основной код сервера
- `Dockerfile`: Инструкции для сборки Docker-образа
- `pyproject.toml`: Зависимости проекта
- `rockyou.txt`: Список паролей для генерации (скачивается автоматически в Docker)
- `.python-version`: Указывает версию Python 3.14

## Безопасность

- ZIP-файлы шифруются с использованием AES
- Пароли выбираются случайно из списка
- Флаги для web скрыты в HTML (не отображаются визуально)Refactor code structure for improved readability and maintainability